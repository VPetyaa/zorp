language: cpp
compiler:
  - gcc
  - clang

before_install:
  - echo "deb http://download.opensuse.org/repositories/home:/VPetya:/zorp/xUbuntu_12.04/ ./" | sudo tee -a /etc/apt/sources.list
  - sudo sh -c "echo 'deb http://download.opensuse.org/repositories/openSUSE:/Tools/xUbuntu_12.04/ /' >> /etc/apt/sources.list.d/osc.list"
  - wget -qO - http://download.opensuse.org/repositories/home:/VPetya:/zorp/xUbuntu_12.04/Release.key | sudo apt-key add -
  - wget -qO - http://download.opensuse.org/repositories/openSUSE:Tools/xUbuntu_12.04/Release.key | sudo apt-key add -
  - sudo apt-get update -qq
  - sudo apt-get install libboost-test-dev
  - wget http://cz.archive.ubuntu.com/ubuntu/pool/main/a/automake/automake1.4_1.4-p6-13.1_all.deb
  - wget http://cz.archive.ubuntu.com/ubuntu/pool/main/a/autoconf/autoconf_2.69-6_all.deb
  - sudo dpkg -i autoconf_2.69-6_all.deb
  - sudo dpkg -i automake1.4_1.4-p6-13.1_all.deb
  - sudo apt-get update -qq
  - echo -e "" | sudo apt-get install osc

script:
  - sudo apt-get install -qq devscripts equivs
  - sudo mk-build-deps -i
  - ./autogen.sh
  - ./configure
  - make

after_success:
  - git branch | grep '\*' | sed 's/\* //g'
  - branch=$TRAVIS_BRANCH
  - dpkg-buildpackage -S
  - echo -e "addFilter(\".*\") \n" > ../zorp.rpmlintrc
  - cp rpm/* ../
  - echo -e "[general]\napiurl = https://api.opensuse.org\n[https://api.opensuse.org]\nuser = VPetya\npass = $PASS\n" > ~/.oscrc
  - osc co security:Zorp:$branch
  - rm security:Zorp:$branch/zorp/*
  - mv ../*.* security:Zorp:$branch/zorp
  - cd security:Zorp:$branch/zorp
  - osc addremove
  - osc commit -m "TRAVIS"


env:
  global:
    secure: JEYTxlkBh2dMQqqEk73J02XAdVVzpwxhtDUcOB5CpiDhioz5KSbqTdVfZLgIkC6bOWqDOfLg28gbVFKhEA/jyDprGP56dyaWxHLxgG9gPwgfoHOd6U/P00pfPdpxlpSvpE3zTnkVx5T4KkSoHNz94z2NBlh44lQUnkJr+5aL98c=
